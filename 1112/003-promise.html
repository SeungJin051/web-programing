<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Login Page</title>
	</head>
	<body>
		<h2>Login</h2>
		<form onsubmit="handleLogin(event)">
			<label for="id">ID:</label>
			<input type="text" id="id" name="id" required /> <br />
			<label for="pwd">Password:</label>
			<input type="password" id="pwd" name="pwd" required /> <br />
			<button type="submit">Login</button>
		</form>
		<div id="result"></div>
		<script>
			function loginRequest(id, pwd) {
				return new Promise((resolve, reject) => {
					fetch('http://sglab801.iptime.org:3000/login', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
						},
						body: JSON.stringify({ id, pwd }),
					})
						.then(res => {
							if (!res.ok) {
								reject(`Failed to login ${res.status}`);
							}
							return res.text();
						})
						.then(data => {
							resolve(data);
							console.log(data);
						});
				});
			}

			function handleLogin(evnet) {
				event.preventDefault();

				const id = document.getElementById('id').value;
				const pwd = document.getElementById('pwd').value;

				const loginPromise = loginRequest(id, pwd);

				loginPromise
					.then(result => {
						document.getElementById('result').innerHTML = result;
					})
					.catch(err => {
						console.log(err);
						document.getElementById(result).innerHTML =
							'<p>Something wnet wrong</p>';
					});
			}
		</script>
	</body>
</html>
